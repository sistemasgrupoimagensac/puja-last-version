import{M as u}from"./bootstrap.esm-DgeKcj6p.js";let o=[],a=null,l=null,c=null,m=null,i=null;document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("unidadModal");l=new u(t,{backdrop:"static"});const e=document.getElementById("confirmDeleteModal");c=new u(e,{backdrop:"static"}),i=document.getElementById("proyectoForm").dataset.proyectoId||null,console.log("Proyecto ID inicial:",i),document.getElementById("btnAddUnit").addEventListener("click",function(){g(),a=null,y()}),document.getElementById("confirmDeleteBtn").addEventListener("click",function(){m!==null&&(f(m),c.hide())}),typeof initialUnidades<"u"&&initialUnidades.length>0&&(o=initialUnidades.map(d=>({...d,estado:d.estado||1}))),r()});document.getElementById("unidadForm").addEventListener("submit",function(t){t.preventDefault();const e={id:document.getElementById("unidad_id").value||null,dormitorios:document.getElementById("dormitorios").value,precio_soles:document.getElementById("precio_soles").value,area:document.getElementById("area").value,area_techada:document.getElementById("area_techada").value,banios:document.getElementById("banios").value,piso_numero:document.getElementById("piso_numero").value,estado:1};a===null?o.push(e):o[a]=e,r(),document.getElementById("unidadForm").reset(),I()});function r(){const t=document.querySelector("#unidadesTable tbody");t.innerHTML="",o.forEach((e,d)=>{if(e.estado===1){const n=`
                <tr>
                    <td>${e.dormitorios}</td>
                    <td>${e.precio_soles}</td>
                    <td>${e.area}</td>
                    <td>${e.area_techada}</td>
                    <td>${e.banios}</td>
                    <td>${e.piso_numero}</td>
                    <td class="d-flex gap-3">
                        <button type="button" class="btn btn-warning" onclick="editarUnidad(${d})">Editar</button>
                        <button type="button" class="btn btn-danger" onclick="mostrarConfirmacionEliminar(${d})">Eliminar</button>
                    </td>
                </tr>
            `;t.innerHTML+=n}})}function p(t){const e=o[t];document.getElementById("dormitorios").value=e.dormitorios,document.getElementById("precio_soles").value=e.precio_soles,document.getElementById("area").value=e.area,document.getElementById("area_techada").value=e.area_techada,document.getElementById("banios").value=e.banios,document.getElementById("piso_numero").value=e.piso_numero,document.getElementById("unidad_id").value=e.id||"",a=t,y()}function E(t){m=t,c.show()}function f(t){o[t].id?o[t].estado=0:o.splice(t,1),r()}document.getElementById("proyectoForm").addEventListener("submit",function(t){t.preventDefault();const e=new FormData(this);i&&e.append("proyecto_id",i),e.append("unidades",JSON.stringify(o));const d=this.querySelector('button[type="submit"][name="action"]:focus').value;fetch(storeUrl,{method:"POST",body:e,headers:{"X-CSRF-TOKEN":csrfToken,Accept:"application/json"}}).then(n=>n.json()).then(n=>{n.proyecto&&(i=n.proyecto.id,console.log("Proyecto ID actualizado:",i)),n.unidades&&(o=n.unidades.map(s=>({...s,id:s.id.toString()})),r()),n.message&&alert(n.message),d==="guardar_salir"&&(window.location.href="/")}).catch(n=>console.error("Error:",n))});function g(){document.getElementById("unidadForm").reset(),document.getElementById("unidad_id").value="",a=null}function y(){l&&l.show()}function I(){l&&l.hide()}window.editarUnidad=p;window.eliminarUnidad=f;window.proyectoId=i;window.mostrarConfirmacionEliminar=E;
