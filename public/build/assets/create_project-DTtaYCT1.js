import{M as u}from"./bootstrap.esm-DgeKcj6p.js";let n=[],i=null,l=null,s=null,m=null,d=null;document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("unidadModal");l=new u(t,{backdrop:"static"});const e=document.getElementById("confirmDeleteModal");s=new u(e,{backdrop:"static"}),d=document.getElementById("proyectoForm").dataset.proyectoId||null,console.log("Proyecto ID inicial:",d),document.getElementById("btnAddUnit").addEventListener("click",function(){h(),i=null,g()}),document.getElementById("confirmDeleteBtn").addEventListener("click",function(){m!==null&&(p(m),s.hide())}),typeof initialUnidades<"u"&&initialUnidades.length>0&&(n=initialUnidades.map(a=>({...a,estado:a.estado||1}))),c()});document.getElementById("unidadForm").addEventListener("submit",function(t){t.preventDefault();const e={id:document.getElementById("unidad_id").value||null,dormitorios:document.getElementById("dormitorios").value,precio_soles:document.getElementById("precio_soles").value,precio_dolares:document.getElementById("precio_dolares").value,area:document.getElementById("area").value,area_techada:document.getElementById("area_techada").value,banios:document.getElementById("banios").value,piso_numero:document.getElementById("piso_numero").value,estado:1};i===null?n.push(e):n[i]=e,c(),document.getElementById("unidadForm").reset(),_()});function b(){n.sort((t,e)=>t.dormitorios-e.dormitorios)}function c(){b();const t=document.querySelector("#unidadesTable tbody");t.innerHTML="",n.forEach((e,a)=>{if(e.estado===1){const o=imagenesUnidades[e.id]||[],r=o.length>0?o[0].image_url:"/images/placeholder_plano.png",y=e.id?"":"disabled",f=`
                <tr class="">
                    <td>
                        <img src="${r}" alt="Miniatura" style="width: 50px; height: 50px; object-fit: cover;">
                    </td>
                    <td>${e.dormitorios}</td>
                    <td>${Number(e.precio_soles).toLocaleString("en")}</td>
                    <td>${Number(e.precio_dolares).toLocaleString("en")}</td>
                    <td>${e.area}</td>
                    <td>${e.area_techada}</td>
                    <td>${e.banios}</td>
                    <td>${e.piso_numero}</td>
                    <td class="d-flex gap-3 p-3" style="height: 67px;">
                        <button type="button" class="btn btn-warning" onclick="editarUnidad(${a})">Editar</button>
                        <button type="button" class="btn btn-danger" onclick="mostrarConfirmacionEliminar(${a})">Eliminar</button>
                        <button type="button" class="btn button-orange" data-bs-toggle="modal" data-bs-target="#unidadImgUploadModal" ${y} onclick="abrirModalPlano(${e.id||""})">Subir Plano</button>
                    </td>
                </tr>
            `;t.innerHTML+=f}})}function E(t){document.getElementById("unidadImgUploadButton").setAttribute("data-unidad-id",t)}function I(t){const e=n[t];document.getElementById("dormitorios").value=e.dormitorios,document.getElementById("precio_soles").value=e.precio_soles,document.getElementById("precio_dolares").value=e.precio_dolares,document.getElementById("area").value=e.area,document.getElementById("area_techada").value=e.area_techada,document.getElementById("banios").value=e.banios,document.getElementById("piso_numero").value=e.piso_numero,document.getElementById("unidad_id").value=e.id||"",i=t,g()}function B(t){m=t,s.show()}function p(t){n[t].id?n[t].estado=0:n.splice(t,1),c()}document.getElementById("proyectoForm").addEventListener("submit",function(t){t.preventDefault();const e=new FormData(this);d&&e.append("proyecto_id",d),e.append("unidades",JSON.stringify(n));const a=this.querySelector('button[type="submit"][name="action"]:focus').value;fetch(storeUrl,{method:"POST",body:e,headers:{"X-CSRF-TOKEN":csrfToken,Accept:"application/json"}}).then(o=>o.json()).then(o=>{o.proyecto&&(d=o.proyecto.id,window.location.href=`/proyecto/editor/${d}`,console.log("Proyecto ID actualizado:",d)),o.unidades&&(n=o.unidades.map(r=>({...r,id:r.id.toString()})),c()),o.message&&alert(o.message),a==="guardar_salir"&&(window.location.href="/proyectos")}).catch(o=>console.error("Error:",o))});function h(){document.getElementById("unidadForm").reset(),document.getElementById("unidad_id").value="",i=null}function g(){l&&l.show()}function _(){l&&l.hide()}window.editarUnidad=I;window.abrirModalPlano=E;window.eliminarUnidad=p;window.proyectoId=d;window.mostrarConfirmacionEliminar=B;
