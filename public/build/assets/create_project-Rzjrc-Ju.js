import{M as u}from"./bootstrap.esm-Cu-1HGb6.js";let n=[],l=null,r=null,s=null,m=null,i=null;document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("unidadModal");r=new u(t,{backdrop:"static"});const e=document.getElementById("confirmDeleteModal");s=new u(e,{backdrop:"static"}),i=document.getElementById("proyectoForm").dataset.proyectoId||null,document.getElementById("btnAddUnit").addEventListener("click",function(){v(),l=null,y()}),document.getElementById("confirmDeleteBtn").addEventListener("click",function(){m!==null&&(p(m),s.hide())}),typeof initialUnidades<"u"&&initialUnidades.length>0&&(n=initialUnidades.map(d=>({...d,estado:d.estado||1}))),c()});const g=document.querySelector("#loader-overlay");document.getElementById("unidadForm").addEventListener("submit",function(t){t.preventDefault();const e={id:document.getElementById("unidad_id").value||null,dormitorios:document.getElementById("dormitorios").value,precio_soles:document.getElementById("precio_soles").value,precio_dolares:document.getElementById("precio_dolares").value,area:document.getElementById("area").value,area_techada:document.getElementById("area_techada").value,banios:document.getElementById("banios").value,piso_numero:document.getElementById("piso_numero").value,estado:1};l===null?n.push(e):n[l]=e,c(),document.getElementById("unidadForm").reset(),_()});function E(){n.sort((t,e)=>t.dormitorios-e.dormitorios)}function c(){E();const t=document.querySelector("#unidadesTable tbody");t.innerHTML="",n.forEach((e,d)=>{if(e.estado===1){const o=imagenesUnidades[e.id]||[],a=o.length>0?o[0].image_url:"/images/placeholder_plano.png",f=e.id?"":"disabled",b=`
                <tr class="">
                    <td>
                        <img src="${a}" alt="Miniatura" style="width: 50px; height: 50px; object-fit: cover;">
                    </td>
                    <td>${e.dormitorios}</td>
                    <td>${Number(e.precio_soles).toLocaleString("en")}</td>
                    <td>${Number(e.precio_dolares).toLocaleString("en")}</td>
                    <td>${e.area}</td>
                    <td>${e.area_techada}</td>
                    <td>${e.banios}</td>
                    <td>${e.piso_numero}</td>
                    <td class="d-flex gap-3 p-3" style="height: 67px;">
                        <button type="button" class="btn btn-warning" onclick="editarUnidad(${d})">Editar</button>
                        <button type="button" class="btn btn-danger" onclick="mostrarConfirmacionEliminar(${d})">Eliminar</button>
                        <button type="button" class="btn button-orange" data-bs-toggle="modal" data-bs-target="#unidadImgUploadModal" ${f} onclick="abrirModalPlano(${e.id||""})">Subir Plano</button>
                    </td>
                </tr>
            `;t.innerHTML+=b}})}function I(t){document.getElementById("unidadImgUploadButton").setAttribute("data-unidad-id",t)}function B(t){const e=n[t];document.getElementById("dormitorios").value=e.dormitorios,document.getElementById("precio_soles").value=e.precio_soles,document.getElementById("precio_dolares").value=e.precio_dolares,document.getElementById("area").value=e.area,document.getElementById("area_techada").value=e.area_techada,document.getElementById("banios").value=e.banios,document.getElementById("piso_numero").value=e.piso_numero,document.getElementById("unidad_id").value=e.id||"",l=t,y()}function h(t){m=t,s.show()}function p(t){n[t].id?n[t].estado=0:n.splice(t,1),c()}document.getElementById("proyectoForm").addEventListener("submit",function(t){t.preventDefault(),g.style.display="flex";const e=new FormData(this);i&&e.append("proyecto_id",i),e.append("unidades",JSON.stringify(n));const d=this.querySelector('button[type="submit"][name="action"]:focus').value;fetch(storeUrl,{method:"POST",body:e,headers:{"X-CSRF-TOKEN":csrfToken,Accept:"application/json"}}).then(o=>o.ok?o.json():o.json().then(a=>{throw o.status===403&&alert(a.message),new Error(a.message||"Error al guardar el proyecto")})).then(o=>{o.proyecto&&(i=o.proyecto.id,window.location.href=`/proyecto/editor/${i}`),o.unidades&&(n=o.unidades.map(a=>({...a,id:a.id.toString()})),c()),o.message&&alert(o.message),d==="guardar_salir"&&(window.location.href="/proyectos")}).catch(o=>console.error("Error:",o)).finally(()=>{g.style.display="none"})});function v(){document.getElementById("unidadForm").reset(),document.getElementById("unidad_id").value="",l=null}function y(){r&&r.show()}function _(){r&&r.hide()}window.editarUnidad=B;window.abrirModalPlano=I;window.eliminarUnidad=p;window.proyectoId=i;window.mostrarConfirmacionEliminar=h;
