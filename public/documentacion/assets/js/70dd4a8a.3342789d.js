"use strict";(self.webpackChunkdocumentacion=self.webpackChunkdocumentacion||[]).push([[2],{257:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"tecnica/DT_pago_proyecto","title":"Documento T\xe9cnico: Pago de Proyectos Inmobiliarios","description":"1. Resumen","source":"@site/docs/tecnica/DT_pago_proyecto.md","sourceDirName":"tecnica","slug":"/tecnica/DT_pago_proyecto","permalink":"/documentacion/docs/tecnica/DT_pago_proyecto","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var s=r(4848),d=r(8453);const c={},l="Documento T\xe9cnico: Pago de Proyectos Inmobiliarios",o={},a=[{value:"1. Resumen",id:"1-resumen",level:2},{value:"2. Requisitos Funcionales Relacionados",id:"2-requisitos-funcionales-relacionados",level:2},{value:"3. Base de Datos Relacionada",id:"3-base-de-datos-relacionada",level:2},{value:"Tablas Implicadas",id:"tablas-implicadas",level:3},{value:"<strong>Tabla: proyecto_clientes</strong>",id:"tabla-proyecto_clientes",level:4},{value:"<strong>Tabla: proyecto_cronograma_pagos</strong>",id:"tabla-proyecto_cronograma_pagos",level:4},{value:"Relaciones de las Tablas",id:"relaciones-de-las-tablas",level:2},{value:"4. Flujo de Trabajo",id:"4-flujo-de-trabajo",level:2},{value:"Flujo General",id:"flujo-general",level:3},{value:"5. Scripts Relacionados",id:"5-scripts-relacionados",level:2},{value:"<strong>proyecto-pago.blade.php</strong>",id:"proyecto-pagobladephp",level:3},{value:"6. Rutas y M\xe9todos Relacionados",id:"6-rutas-y-m\xe9todos-relacionados",level:2},{value:"7. Interacciones del Backend con OpenPay",id:"7-interacciones-del-backend-con-openpay",level:2},{value:"8. Post-Proceso tras el D\xe9bito",id:"8-post-proceso-tras-el-d\xe9bito",level:2},{value:"9. Validaciones Implementadas",id:"9-validaciones-implementadas",level:2},{value:"10. Historial de Cambios",id:"10-historial-de-cambios",level:2}];function t(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"documento-t\xe9cnico-pago-de-proyectos-inmobiliarios",children:"Documento T\xe9cnico: Pago de Proyectos Inmobiliarios"})}),"\n",(0,s.jsx)(n.h2,{id:"1-resumen",children:"1. Resumen"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n:"})," Este documento detalla el flujo t\xe9cnico del sistema de pagos para proyectos inmobiliarios. El flujo incluye pagos iniciales (50%) o pagos \xfanicos completos seg\xfan el contrato (",(0,s.jsx)(n.code,{children:"pago_fraccionado"})," o ",(0,s.jsx)(n.code,{children:"pago_unico"}),"). Se utiliza OpenPay para procesar los pagos de manera segura."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-requisitos-funcionales-relacionados",children:"2. Requisitos Funcionales Relacionados"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RF002:"})," Permitir pagos mediante tarjeta de cr\xe9dito/d\xe9bito utilizando OpenPay."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RF003:"})," Registrar transacciones de pago asociadas a clientes de proyectos inmobiliarios."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RF004:"})," Generar comprobantes electr\xf3nicos tras el pago exitoso."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-base-de-datos-relacionada",children:"3. Base de Datos Relacionada"}),"\n",(0,s.jsx)(n.h3,{id:"tablas-implicadas",children:"Tablas Implicadas"}),"\n",(0,s.jsx)(n.h4,{id:"tabla-proyecto_clientes",children:(0,s.jsx)(n.strong,{children:"Tabla: proyecto_clientes"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Prop\xf3sito:"}),(0,s.jsx)(n.br,{}),"\n","Esta tabla almacena informaci\xf3n detallada sobre los clientes asociados a proyectos inmobiliarios, incluyendo datos personales, condiciones del contrato y el estado del cliente respecto a sus pagos."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Columna"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Tipo"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"id"}),(0,s.jsx)(n.td,{children:"BIGINT"}),(0,s.jsx)(n.td,{children:"Identificador \xfanico del cliente del proyecto."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"user_id"}),(0,s.jsx)(n.td,{children:"BIGINT"}),(0,s.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,s.jsx)(n.code,{children:"users"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"razon_social"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Nombre o raz\xf3n social del cliente."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ruc"}),(0,s.jsx)(n.td,{children:"VARCHAR(20)"}),(0,s.jsx)(n.td,{children:"N\xfamero de RUC del cliente."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"direccion_fiscal"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Direcci\xf3n fiscal del cliente."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"telefono_inmobiliaria"}),(0,s.jsx)(n.td,{children:"VARCHAR(15)"}),(0,s.jsx)(n.td,{children:"Tel\xe9fono de la inmobiliaria (opcional)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"nombre_comercial"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Nombre comercial del cliente (opcional)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"representante_legal"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Nombre del representante legal del cliente (opcional)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"direccion_representante"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Direcci\xf3n del representante legal (opcional)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"nombre_contacto"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Nombre del contacto principal."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"telefono_contacto"}),(0,s.jsx)(n.td,{children:"VARCHAR(15)"}),(0,s.jsx)(n.td,{children:"Tel\xe9fono del contacto principal."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"email_contacto"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Correo electr\xf3nico del contacto principal."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"fecha_inicio_contrato"}),(0,s.jsx)(n.td,{children:"DATE"}),(0,s.jsx)(n.td,{children:"Fecha de inicio del contrato."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"fecha_fin_contrato"}),(0,s.jsx)(n.td,{children:"DATE"}),(0,s.jsx)(n.td,{children:"Fecha de fin del contrato."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"numero_anuncios"}),(0,s.jsx)(n.td,{children:"INTEGER"}),(0,s.jsx)(n.td,{children:"Cantidad de anuncios incluidos en el plan."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"habilitado"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el cliente est\xe1 habilitado."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"activo"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el cliente est\xe1 activo en el sistema."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"vigente"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el contrato est\xe1 vigente."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"precio_plan"}),(0,s.jsx)(n.td,{children:"DECIMAL(10,2)"}),(0,s.jsx)(n.td,{children:"Precio total del plan contratado."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"periodo_plan"}),(0,s.jsx)(n.td,{children:"INTEGER"}),(0,s.jsx)(n.td,{children:"Duraci\xf3n del plan en meses."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"pago_unico"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el pago es \xfanico."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"pago_fraccionado"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el pago es fraccionado."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"al_dia"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el cliente est\xe1 al d\xeda con los pagos."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"pagado"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el plan fue completamente pagado."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"renovacion"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el contrato es renovable."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"contrato_url"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"URL del contrato en formato digital."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"created_at"}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"updated_at"}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"tabla-proyecto_cronograma_pagos",children:(0,s.jsx)(n.strong,{children:"Tabla: proyecto_cronograma_pagos"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Prop\xf3sito:"}),(0,s.jsx)(n.br,{}),"\n","Registra los pagos programados de clientes con opci\xf3n de pago fraccionado, detallando fechas, montos y estados de cada pago."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Columna"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Tipo"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"id"}),(0,s.jsx)(n.td,{children:"BIGINT"}),(0,s.jsx)(n.td,{children:"Identificador \xfanico del cronograma de pago."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"proyecto_cliente_id"}),(0,s.jsx)(n.td,{children:"BIGINT"}),(0,s.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,s.jsx)(n.code,{children:"proyecto_clientes"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"fecha_programada"}),(0,s.jsx)(n.td,{children:"DATE"}),(0,s.jsx)(n.td,{children:"Fecha programada para el cobro."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"monto"}),(0,s.jsx)(n.td,{children:"DECIMAL(10, 2)"}),(0,s.jsx)(n.td,{children:"Monto del pago programado."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"estado"}),(0,s.jsx)(n.td,{children:"ENUM"}),(0,s.jsxs)(n.td,{children:["Estado del pago (",(0,s.jsx)(n.code,{children:"pendiente"}),", ",(0,s.jsx)(n.code,{children:"pagado"}),", etc.)."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"intentos"}),(0,s.jsx)(n.td,{children:"UNSIGNED INTEGER"}),(0,s.jsx)(n.td,{children:"N\xfamero de intentos realizados para el cobro."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"reintento_hasta"}),(0,s.jsx)(n.td,{children:"DATE"}),(0,s.jsx)(n.td,{children:"Fecha l\xedmite para reintentos."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"fecha_ultimo_intento"}),(0,s.jsx)(n.td,{children:"DATETIME"}),(0,s.jsx)(n.td,{children:"Fecha del \xfaltimo intento de cobro."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"razon_fallo"}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Raz\xf3n del fallo del cobro (si aplica)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"fallo_final"}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Indica si el pago fall\xf3 despu\xe9s de todos los reintentos."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"created_at"}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"updated_at"}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"relaciones-de-las-tablas",children:"Relaciones de las Tablas"}),"\n",(0,s.jsx)(n.mermaid,{value:'erDiagram\r\n    users {\r\n        BIGINT id PK\r\n        BOOLEAN not_pay\r\n        VARCHAR codigo_unico\r\n        VARCHAR nombres\r\n        VARCHAR apellidos\r\n        VARCHAR email\r\n        VARCHAR password\r\n        VARCHAR google_id\r\n        VARCHAR numero_documento\r\n        VARCHAR celular\r\n        VARCHAR imagen\r\n        SMALLINT estado\r\n        BOOLEAN acepta_termino_condiciones\r\n        BOOLEAN acepta_confidencialidad\r\n        TIMESTAMP email_verified_at\r\n        VARCHAR remember_token\r\n        TIMESTAMP created_at\r\n        TIMESTAMP updated_at\r\n    }\r\n\r\n    proyecto_clientes {\r\n        BIGINT id PK\r\n        BIGINT user_id FK\r\n        VARCHAR razon_social\r\n        VARCHAR ruc\r\n        VARCHAR direccion_fiscal\r\n        VARCHAR telefono_inmobiliaria\r\n        VARCHAR nombre_comercial\r\n        VARCHAR representante_legal\r\n        VARCHAR direccion_representante\r\n        VARCHAR nombre_contacto\r\n        VARCHAR telefono_contacto\r\n        VARCHAR email_contacto\r\n        DATE fecha_inicio_contrato\r\n        DATE fecha_fin_contrato\r\n        INT numero_anuncios\r\n        BOOLEAN habilitado\r\n        BOOLEAN activo\r\n        BOOLEAN vigente\r\n        DECIMAL precio_plan\r\n        INT periodo_plan\r\n        BOOLEAN pago_unico\r\n        BOOLEAN pago_fraccionado\r\n        BOOLEAN al_dia\r\n        BOOLEAN pagado\r\n        BOOLEAN renovacion\r\n        VARCHAR contrato_url\r\n    }\r\n\r\n    proyecto_cronograma_pagos {\r\n        BIGINT id PK\r\n        BIGINT proyecto_cliente_id FK\r\n        DATE fecha_programada\r\n        DECIMAL monto\r\n        INT estado_pago_id\r\n        ENUM estado\r\n        DATE reintento_hasta\r\n        DATETIME fecha_ultimo_intento\r\n        VARCHAR razon_fallo\r\n        BOOLEAN fallo_final\r\n    }\r\n\r\n    users ||--o{ proyecto_clientes : "1:N"\r\n    proyecto_clientes ||--o{ proyecto_cronograma_pagos : "1:N"'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-flujo-de-trabajo",children:"4. Flujo de Trabajo"}),"\n",(0,s.jsx)(n.h3,{id:"flujo-general",children:"Flujo General"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Inicio de Sesi\xf3n:"}),(0,s.jsx)(n.br,{}),"\n","Al iniciar sesi\xf3n, si el usuario tiene pagos pendientes (",(0,s.jsx)(n.code,{children:"al_dia"})," = false), se redirige a la vista ",(0,s.jsx)(n.code,{children:"/proyecto-pago"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Vista de Pago:"}),(0,s.jsx)(n.br,{}),"\n","En ",(0,s.jsx)(n.code,{children:"proyecto-pago.blade.php"})," se presenta:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detalles del plan contratado."}),"\n",(0,s.jsx)(n.li,{children:"Formulario de pago con tarjeta."}),"\n",(0,s.jsx)(n.li,{children:"Selecci\xf3n de RUC o DNI para comprobantes."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Procesamiento del Pago:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Crear Cliente:"})," Se registra el cliente en OpenPay."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Asociar Tarjeta:"})," Se tokeniza la tarjeta y se asocia al cliente."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Realizar D\xe9bito:"})," Se procesa el pago."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Post-Pago:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Registro de transacci\xf3n."}),"\n",(0,s.jsx)(n.li,{children:"Generaci\xf3n de comprobantes electr\xf3nicos."}),"\n",(0,s.jsx)(n.li,{children:"Actualizaci\xf3n del estado del cliente."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-scripts-relacionados",children:"5. Scripts Relacionados"}),"\n",(0,s.jsx)(n.h3,{id:"proyecto-pagobladephp",children:(0,s.jsx)(n.strong,{children:"proyecto-pago.blade.php"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Confirmaci\xf3n de Estado del Pago"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"confimarEstadoPago() {\r\n    const dataProyectoClienteId = {\r\n        \"proyectoClienteId\": {{ $proyectoClienteId }},\r\n    };\r\n\r\n    fetch('/confirmacion_pago_proyecto', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Accept': 'application/json',\r\n            'Content-Type': 'application/json',\r\n            'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content')\r\n        },\r\n        body: JSON.stringify(dataProyectoClienteId)\r\n    })\r\n    .then(response => response.json())\r\n    .then(data => {\r\n        if(data.up_to_date) {\r\n            window.location.replace('/login'); \r\n        }\r\n    });\r\n}\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Procesamiento Completo del Pago"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"handleTokenSuccess(response) {\r\n    const source_id = response.data.id;\r\n    const price = {{ $precio }};\r\n    const proyectoClienteId = {{ $proyectoClienteId }};\r\n\r\n    const formPost = {\r\n        source_id,\r\n        method: \"card\",\r\n        amount: price,\r\n        currency: 'PEN',\r\n        description: '{{ $descripcion }}',\r\n        device_session_id: this.deviceSessionId,\r\n        customer: {\r\n            name: '{{ $razonSocial }}',\r\n            phone_number: '{{ $telefono }}',\r\n            email: '{{ $correo }}'\r\n        }\r\n    };\r\n\r\n    this.createCustomer(formPost.customer)\r\n        .then(customer => {\r\n            this.associateCardToCustomer(customer.id, formPost.source_id, formPost.device_session_id)\r\n                .then(cardData => {\r\n                    this.realizarDebitoInicial(formPost, cardData, proyectoClienteId);\r\n                });\r\n        });\r\n}\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Guardar Tarjeta y Estado del Proyecto"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"saveCardData(cardData, proyectoClienteId) {\r\n    fetch('/guardar_tarjeta', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Accept': 'application/json',\r\n            'Content-Type': 'application/json',\r\n            'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content')\r\n        },\r\n        body: JSON.stringify({\r\n            proyecto_cliente_id: proyectoClienteId,\r\n            customer_id: cardData.customer_id,\r\n            card_id: cardData.id,\r\n            card_brand: cardData.brand,\r\n            card_last_digits: cardData.card_number,\r\n            expiration_month: cardData.expiration_month,\r\n            expiration_year: cardData.expiration_year,\r\n            holder_name: cardData.holder_name,\r\n            type: cardData.type,\r\n        })\r\n    });\r\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-rutas-y-m\xe9todos-relacionados",children:"6. Rutas y M\xe9todos Relacionados"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Ruta"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"M\xe9todo"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Controlador"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"/confirmacion_pago_proyecto"}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"ConfirmacionPagoAntesDeDebitar"}),(0,s.jsx)(n.td,{children:"Verifica si el cliente est\xe1 al d\xeda antes de procesar el pago."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"/guardar_tarjeta"}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"CustomerCardController@store"}),(0,s.jsx)(n.td,{children:"Guarda los datos de la tarjeta en la base de datos."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"/realizar_debito"}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"PlanController@realizarDebito"}),(0,s.jsx)(n.td,{children:"Procesa el pago con OpenPay."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"/crear_cliente"}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"PlanController@crearCliente"}),(0,s.jsx)(n.td,{children:"Registra un cliente en OpenPay."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"/asociar_tarjeta"}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"PlanController@asociarTarjeta"}),(0,s.jsx)(n.td,{children:"Asocia una tarjeta tokenizada al cliente en OpenPay."})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7-interacciones-del-backend-con-openpay",children:"7. Interacciones del Backend con OpenPay"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Crear Cliente"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ruta: ",(0,s.jsx)(n.code,{children:"/crear_cliente"})]}),"\n",(0,s.jsx)(n.li,{children:"L\xf3gica: Registra un cliente en OpenPay usando su nombre, correo y tel\xe9fono."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Asociar Tarjeta"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ruta: ",(0,s.jsx)(n.code,{children:"/asociar_tarjeta"})]}),"\n",(0,s.jsx)(n.li,{children:"L\xf3gica: Usa un token generado por OpenPay para asociar la tarjeta al cliente."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Realizar D\xe9bito"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ruta: ",(0,s.jsx)(n.code,{children:"/realizar_debito"})]}),"\n",(0,s.jsxs)(n.li,{children:["L\xf3gica:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Procesa el cargo usando ",(0,s.jsx)(n.code,{children:"customer_id"})," y ",(0,s.jsx)(n.code,{children:"card_id"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Devuelve detalles del estado del d\xe9bito."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"8-post-proceso-tras-el-d\xe9bito",children:"8. Post-Proceso tras el D\xe9bito"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Actualizar Estado del Cliente:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Campos como ",(0,s.jsx)(n.code,{children:"al_dia"})," y ",(0,s.jsx)(n.code,{children:"pagado"})," son actualizados en ",(0,s.jsx)(n.code,{children:"proyecto_clientes"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Registro de Transacci\xf3n:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detalles del pago son almacenados en la base de datos."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generaci\xf3n de Comprobante Electr\xf3nico:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Integraci\xf3n para emitir comprobantes tras un pago exitoso."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"9-validaciones-implementadas",children:"9. Validaciones Implementadas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Estado del Cliente:"})," Verificar que el cliente tiene pagos pendientes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integridad del Pago:"})," Validar datos del cliente, tarjeta y monto antes de procesar el pago."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Errores de OpenPay:"})," Manejo de errores con mensajes claros al usuario."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"10-historial-de-cambios",children:"10. Historial de Cambios"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Versi\xf3n"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Fecha"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Cambios Realizados"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Autor"})})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"v1.0"}),(0,s.jsx)(n.td,{children:"1/12/2024"}),(0,s.jsx)(n.td,{children:"Documento t\xe9cnico inicial creado."}),(0,s.jsx)(n.td,{children:"Equipo de Desarrollo"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var i=r(6540);const s={},d=i.createContext(s);function c(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);