"use strict";(self.webpackChunkdocumentacion=self.webpackChunkdocumentacion||[]).push([[9096],{9774:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"tecnica/DT_pago_inmuebles","title":"Documento T\xe9cnico: Pago para Propietarios, Acreedores y Corredores","description":"1. Resumen","source":"@site/docs/tecnica/DT_pago_inmuebles.md","sourceDirName":"tecnica","slug":"/tecnica/DT_pago_inmuebles","permalink":"/documentacion/docs/tecnica/DT_pago_inmuebles","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Documento T\xe9cnico: Publicar Proyecto Inmobiliario","permalink":"/documentacion/docs/tecnica/DT_005_publicar_proyecto"},"next":{"title":"Registro en Puja Inmobiliaria","permalink":"/documentacion/docs/usuario/MU_registrar_usuario"}}');var i=s(4848),l=s(8453);const d={},a="Documento T\xe9cnico: Pago para Propietarios, Acreedores y Corredores",c={},o=[{value:"1. Resumen",id:"1-resumen",level:2},{value:"2. Requisitos Funcionales Relacionados",id:"2-requisitos-funcionales-relacionados",level:2},{value:"3. Base de Datos Relacionada",id:"3-base-de-datos-relacionada",level:2},{value:"Tablas Implicadas",id:"tablas-implicadas",level:3},{value:"<strong>Tabla: <code>plans</code></strong>",id:"tabla-plans",level:4},{value:"<strong>Tabla: <code>avisos</code></strong>",id:"tabla-avisos",level:4},{value:"<strong>Tabla: <code>historial_avisos</code></strong>",id:"tabla-historial_avisos",level:4},{value:"<strong>Tabla: <code>transacciones</code></strong>",id:"tabla-transacciones",level:4},{value:"4. Relaci\xf3n de Tablas",id:"4-relaci\xf3n-de-tablas",level:2},{value:"5. Rutas Relacionadas",id:"5-rutas-relacionadas",level:2},{value:"<strong>Controlador:</strong> <code>PlanController.php</code>",id:"controlador-plancontrollerphp",level:2},{value:"<strong>M\xe9todo: <code>pay_openpay</code></strong>",id:"m\xe9todo-pay_openpay",level:3},{value:"<strong>Detalles T\xe9cnicos</strong>",id:"detalles-t\xe9cnicos",level:4},{value:"<strong>Interacci\xf3n con el Frontend</strong>",id:"interacci\xf3n-con-el-frontend",level:4},{value:"<strong>M\xe9todo: <code>post_ad</code></strong>",id:"m\xe9todo-post_ad",level:3},{value:"<strong>Detalles T\xe9cnicos</strong>",id:"detalles-t\xe9cnicos-1",level:4},{value:"<strong>Interacci\xf3n con el Frontend</strong>",id:"interacci\xf3n-con-el-frontend-1",level:4},{value:"<strong>M\xe9todo: <code>get_data_openpay</code></strong>",id:"m\xe9todo-get_data_openpay",level:3},{value:"<strong>Detalles T\xe9cnicos</strong>",id:"detalles-t\xe9cnicos-2",level:4},{value:"<strong>Interacci\xf3n con el Frontend</strong>",id:"interacci\xf3n-con-el-frontend-2",level:4},{value:"<strong>Resumen de Interacciones con el Frontend</strong>",id:"resumen-de-interacciones-con-el-frontend",level:3},{value:"7. APIs y Detalles T\xe9cnicos",id:"7-apis-y-detalles-t\xe9cnicos",level:2},{value:"<strong>OpenPay</strong>",id:"openpay",level:3},{value:"<strong>Detalles T\xe9cnicos</strong>",id:"detalles-t\xe9cnicos-3",level:4},{value:"<strong>Estructura de la Solicitud</strong>",id:"estructura-de-la-solicitud",level:4},{value:"<strong>Estructura de la Respuesta</strong>",id:"estructura-de-la-respuesta",level:4},{value:"<strong>Fetch Requests</strong>",id:"fetch-requests",level:3},{value:"<strong>Endpoint:</strong> <code>POST /pagar-openpay</code>",id:"endpoint-post-pagar-openpay",level:4},{value:"<strong>Endpoint:</strong> <code>POST /contratar_plan</code>",id:"endpoint-post-contratar_plan",level:4},{value:"<strong>Endpoint:</strong> <code>POST /get-data-openpay</code>",id:"endpoint-post-get-data-openpay",level:4},{value:"<strong>Interacci\xf3n Completa</strong>",id:"interacci\xf3n-completa",level:3},{value:"8. Vistas Relacionadas con el Pago",id:"8-vistas-relacionadas-con-el-pago",level:2},{value:"<strong>8.1. Vistas de Selecci\xf3n de Planes</strong>",id:"81-vistas-de-selecci\xf3n-de-planes",level:3},{value:"<strong><code>planes.blade.php</code></strong>",id:"planesbladephp",level:4},{value:"<strong><code>planes-acreedor.blade.php</code></strong>",id:"planes-acreedorbladephp",level:4},{value:"<strong><code>planes-propietario.blade.php</code></strong>",id:"planes-propietariobladephp",level:4},{value:"<strong>8.2. Componente Centralizado de Pago</strong>",id:"82-componente-centralizado-de-pago",level:3},{value:"<strong><code>pay-modal.blade.php</code></strong>",id:"pay-modalbladephp",level:4},{value:"<strong>8.3. Flujo Completo desde el Frontend</strong>",id:"83-flujo-completo-desde-el-frontend",level:3},{value:"<strong>8.4. Notificaciones Toast</strong>",id:"84-notificaciones-toast",level:3},{value:"<strong><code>triggerToastSuccess</code></strong>",id:"triggertoastsuccess",level:4},{value:"<strong><code>triggerToastPayError</code></strong>",id:"triggertoastpayerror",level:4},{value:"<strong>Eventos en <code>pay-modal.blade.php</code>:</strong>",id:"eventos-en-pay-modalbladephp",level:4},{value:"<strong>8.5. C\xf3digo Relacionado</strong>",id:"85-c\xf3digo-relacionado",level:3},{value:"<strong>Ejemplo de Uso en <code>planes.blade.php</code>:</strong>",id:"ejemplo-de-uso-en-planesbladephp",level:4},{value:"9. Referencias a la Documentaci\xf3n de OpenPay",id:"9-referencias-a-la-documentaci\xf3n-de-openpay",level:2},{value:"10. Historial de Cambios",id:"10-historial-de-cambios",level:2}];function t(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"documento-t\xe9cnico-pago-para-propietarios-acreedores-y-corredores",children:"Documento T\xe9cnico: Pago para Propietarios, Acreedores y Corredores"})}),"\n",(0,i.jsx)(n.h2,{id:"1-resumen",children:"1. Resumen"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Este documento t\xe9cnico describe la implementaci\xf3n del flujo de pago para propietarios, acreedores y corredores en la plataforma ",(0,i.jsx)(n.strong,{children:"Puja Inmobiliaria"}),". Incluye la interacci\xf3n con el sistema OpenPay para procesar pagos con tarjeta de cr\xe9dito/d\xe9bito y las operaciones relacionadas, como la gesti\xf3n de planes y publicaci\xf3n de avisos."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Prop\xf3sito:"})," Documentar la l\xf3gica del sistema de pago, incluyendo vistas, controladores, rutas y la relaci\xf3n con OpenPay, para facilitar su mantenimiento y escalabilidad."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-requisitos-funcionales-relacionados",children:"2. Requisitos Funcionales Relacionados"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RF002:"})," Permitir a los usuarios contratar un plan de visibilidad para sus avisos."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RF003:"})," Permitir pagos mediante tarjeta de cr\xe9dito o d\xe9bito utilizando OpenPay."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RF004:"})," Registrar transacciones de pago y asociarlas a usuarios y planes seleccionados."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-base-de-datos-relacionada",children:"3. Base de Datos Relacionada"}),"\n",(0,i.jsx)(n.h3,{id:"tablas-implicadas",children:"Tablas Implicadas"}),"\n",(0,i.jsx)(n.h4,{id:"tabla-plans",children:(0,i.jsxs)(n.strong,{children:["Tabla: ",(0,i.jsx)(n.code,{children:"plans"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","La tabla ",(0,i.jsx)(n.code,{children:"plans"})," almacena informaci\xf3n sobre los planes disponibles para los usuarios, que definen la cantidad de avisos, duraci\xf3n y caracter\xedsticas de visibilidad."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relaciones:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"avisos"}),":"]})," Un plan puede ser asociado a varios avisos a trav\xe9s de la relaci\xf3n con la tabla ",(0,i.jsx)(n.code,{children:"plan_user"}),", lo que permite que los usuarios publiquen inmuebles en la plataforma bajo un plan espec\xedfico."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"transacciones"}),":"]})," Registra las transacciones realizadas para adquirir un plan."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Estructura:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Columna"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Tipo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Identificador \xfanico del plan."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"package_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,i.jsx)(n.code,{children:"packages"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"name"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Nombre del plan."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"price"})}),(0,i.jsx)(n.td,{children:"DECIMAL"}),(0,i.jsx)(n.td,{children:"Precio del plan."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"duration_in_days"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Duraci\xf3n en d\xedas del plan."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"total_ads"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Cantidad total de avisos permitidos por el plan."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"typical_ads"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Cantidad de avisos t\xedpicos permitidos."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"top_ads"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Cantidad de avisos top permitidos."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"premium_ads"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Cantidad de avisos premium permitidos."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"estado"})}),(0,i.jsx)(n.td,{children:"BOOLEAN"}),(0,i.jsx)(n.td,{children:"Estado del plan (activo/inactivo)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"created_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updated_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"tabla-avisos",children:(0,i.jsxs)(n.strong,{children:["Tabla: ",(0,i.jsx)(n.code,{children:"avisos"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","La tabla ",(0,i.jsx)(n.code,{children:"avisos"})," registra los inmuebles que los usuarios publican en la plataforma, permitiendo almacenar informaci\xf3n como fecha de publicaci\xf3n, estado, y cantidad de visualizaciones."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relaciones:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"inmuebles"}),":"]})," Cada aviso est\xe1 asociado a un inmueble espec\xedfico."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"historial_avisos"}),":"]})," Lleva un registro de los estados por los que ha pasado el aviso."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"plan_user"}),":"]})," Relaciona los avisos con el plan que les da visibilidad en la plataforma."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Estructura:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Columna"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Tipo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Identificador \xfanico del aviso."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"inmueble_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,i.jsx)(n.code,{children:"inmuebles"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"fecha_publicacion"})}),(0,i.jsx)(n.td,{children:"DATETIME"}),(0,i.jsx)(n.td,{children:"Fecha y hora de publicaci\xf3n del aviso."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"estado"})}),(0,i.jsx)(n.td,{children:"BOOLEAN"}),(0,i.jsx)(n.td,{children:"Estado del aviso (activo/inactivo)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"views"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Cantidad de visualizaciones del aviso."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"created_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updated_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"tabla-historial_avisos",children:(0,i.jsxs)(n.strong,{children:["Tabla: ",(0,i.jsx)(n.code,{children:"historial_avisos"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n",'Esta tabla lleva un registro hist\xf3rico de los cambios en el estado de los avisos. Cada vez que un aviso cambia de estado (por ejemplo, de "inactivo" a "publicado"), se crea un nuevo registro.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relaciones:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"avisos"}),":"]})," Cada entrada en el historial pertenece a un aviso espec\xedfico."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"estados_avisos"}),":"]})," Almacena el estado del aviso en el momento del cambio."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Estructura:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Columna"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Tipo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Identificador \xfanico del historial."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"aviso_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,i.jsx)(n.code,{children:"avisos"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"estado_aviso_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["Relaci\xf3n con la tabla ",(0,i.jsx)(n.code,{children:"estados_avisos"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"created_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updated_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"tabla-transacciones",children:(0,i.jsxs)(n.strong,{children:["Tabla: ",(0,i.jsx)(n.code,{children:"transacciones"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","La tabla ",(0,i.jsx)(n.code,{children:"transacciones"})," registra los pagos realizados por los usuarios al adquirir planes o servicios. Contiene detalles sobre el cliente, el m\xe9todo de pago y el estado de la transacci\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relaciones:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Con ",(0,i.jsx)(n.code,{children:"plans"}),":"]})," Relaciona una transacci\xf3n con el plan adquirido."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Con usuarios:"})," A trav\xe9s de un cliente, asocia las transacciones a un usuario."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Estructura:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Columna"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Tipo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Identificador \xfanico de la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"amount"})}),(0,i.jsx)(n.td,{children:"DECIMAL"}),(0,i.jsx)(n.td,{children:"Monto de la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currency"})}),(0,i.jsx)(n.td,{children:"VARCHAR(10)"}),(0,i.jsx)(n.td,{children:"Moneda utilizada en la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"customer_name"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Nombre del cliente que realiz\xf3 la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"customer_email"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Correo electr\xf3nico del cliente."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"customer_phone_number"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"N\xfamero de tel\xe9fono del cliente."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"card_bank_code"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"C\xf3digo del banco de la tarjeta utilizada."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"card_bank_name"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Nombre del banco de la tarjeta utilizada."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"card_holder_name"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Nombre del titular de la tarjeta."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"card_type"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Tipo de tarjeta (d\xe9bito/cr\xe9dito)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"description"})}),(0,i.jsx)(n.td,{children:"TEXT"}),(0,i.jsx)(n.td,{children:"Descripci\xf3n del plan adquirido."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"status"})}),(0,i.jsx)(n.td,{children:"BOOLEAN"}),(0,i.jsx)(n.td,{children:"Estado de la transacci\xf3n (0: fallida, 1: exitosa)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"creation_date"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error_description"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"Descripci\xf3n del error, en caso de fallo."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error_code"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"C\xf3digo del error, en caso de fallo."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"request_id"})}),(0,i.jsx)(n.td,{children:"VARCHAR(255)"}),(0,i.jsx)(n.td,{children:"ID de la solicitud a OpenPay."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"created_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de creaci\xf3n del registro."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updated_at"})}),(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsx)(n.td,{children:"Fecha de \xfaltima actualizaci\xf3n del registro."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-relaci\xf3n-de-tablas",children:"4. Relaci\xf3n de Tablas"}),"\n",(0,i.jsx)(n.mermaid,{value:'erDiagram\r\n    plans {\r\n        bigint id PK\r\n        bigint package_id FK\r\n        string name\r\n        decimal price\r\n        int duration_in_days\r\n        int total_ads\r\n        int typical_ads\r\n        int top_ads\r\n        int premium_ads\r\n        boolean estado\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n    avisos {\r\n        bigint id PK\r\n        bigint inmueble_id FK\r\n        datetime fecha_publicacion\r\n        boolean estado\r\n        int views\r\n        bigint plan_user_id FK\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n    historial_avisos {\r\n        bigint id PK\r\n        bigint aviso_id FK\r\n        bigint estado_aviso_id FK\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n    transacciones {\r\n        bigint id PK\r\n        decimal amount\r\n        string currency\r\n        string customer_name\r\n        string customer_email\r\n        string customer_phone_number\r\n        string card_bank_code\r\n        string card_bank_name\r\n        string card_holder_name\r\n        string card_type\r\n        text description\r\n        boolean status\r\n        timestamp creation_date\r\n        string error_description\r\n        string error_code\r\n        string request_id\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n    plan_users {\r\n        bigint id PK\r\n        bigint user_id FK\r\n        bigint plan_id FK\r\n        int typical_ads_remaining\r\n        int top_ads_remaining\r\n        int premium_ads_remaining\r\n        datetime start_date\r\n        datetime end_date\r\n        int estado\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n\r\n    plans ||--o{ plan_users : "1:N"\r\n    plan_users ||--o{ avisos : "1:N"\r\n    avisos ||--o{ historial_avisos : "1:N"\r\n    plan_users ||--o{ transacciones : "1:N"'}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-rutas-relacionadas",children:"5. Rutas Relacionadas"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Ruta"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"M\xe9todo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Controlador"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/pagar-openpay"})}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PlanController"})}),(0,i.jsx)(n.td,{children:"Procesa el pago utilizando OpenPay."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/contratar_plan"})}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PlanController"})}),(0,i.jsx)(n.td,{children:"Asocia un aviso a un plan y registra la transacci\xf3n."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/get-data-openpay"})}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PlanController"})}),(0,i.jsx)(n.td,{children:"Proporciona las credenciales de OpenPay."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h1,{id:"6-m\xe9todos-del-controlador",children:"6. M\xe9todos del Controlador"}),"\n",(0,i.jsxs)(n.h2,{id:"controlador-plancontrollerphp",children:[(0,i.jsx)(n.strong,{children:"Controlador:"})," ",(0,i.jsx)(n.code,{children:"PlanController.php"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ruta:"})," ",(0,i.jsx)(n.code,{children:"/app/Http/Controllers/PlanController.php"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"m\xe9todo-pay_openpay",children:(0,i.jsxs)(n.strong,{children:["M\xe9todo: ",(0,i.jsx)(n.code,{children:"pay_openpay"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ruta:"})," ",(0,i.jsx)(n.code,{children:"/pagar-openpay"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Este m\xe9todo interact\xfaa con OpenPay para procesar los pagos realizados por los usuarios. Se encarga de enviar los datos de la transacci\xf3n al sistema de pagos externo y devolver la respuesta correspondiente al frontend."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"detalles-t\xe9cnicos",children:(0,i.jsx)(n.strong,{children:"Detalles T\xe9cnicos"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Entradas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Datos enviados desde el frontend como:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"source_id"}),": Token generado por OpenPay para identificar la tarjeta de cr\xe9dito/d\xe9bito."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"amount"}),": Monto del pago."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"description"}),": Descripci\xf3n del plan adquirido."]}),"\n",(0,i.jsx)(n.li,{children:"Informaci\xf3n del cliente (nombre, correo, tel\xe9fono)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Estos datos se env\xedan en formato JSON."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo de Trabajo:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Obtenci\xf3n de Credenciales:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["El m\xe9todo recupera las credenciales configuradas en el archivo ",(0,i.jsx)(n.code,{children:".env"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_URL"}),": URL base de OpenPay."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_ID"}),": Identificador \xfanico de la cuenta OpenPay."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_SK"}),": Clave secreta de OpenPay."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generaci\xf3n del Token de Autenticaci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Se genera un token Base64 con las credenciales de OpenPay para autenticarse en el servicio."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solicitud al API de OpenPay:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Realiza una llamada HTTP POST al endpoint ",(0,i.jsx)(n.code,{children:"/charges"})," de OpenPay, enviando los datos del pago en formato JSON."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Recepci\xf3n y Manejo de Respuesta:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"OpenPay responde con un objeto JSON que incluye el estado del pago, detalles de la transacci\xf3n y errores (si los hay)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Devoluci\xf3n de la Respuesta al Frontend:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"La respuesta de OpenPay se retorna al cliente para informar si el pago fue exitoso o fallido."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Salidas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Objeto JSON con los datos de la respuesta de OpenPay:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si el pago es exitoso:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Estado de la transacci\xf3n (",(0,i.jsx)(n.code,{children:"status"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Informaci\xf3n del banco (",(0,i.jsx)(n.code,{children:"card_bank_name"}),", ",(0,i.jsx)(n.code,{children:"card_bank_code"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Tipo de tarjeta (",(0,i.jsx)(n.code,{children:"card_type"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Si el pago falla:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Descripci\xf3n del error (",(0,i.jsx)(n.code,{children:"error_description"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["C\xf3digo del error (",(0,i.jsx)(n.code,{children:"error_code"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"interacci\xf3n-con-el-frontend",children:(0,i.jsx)(n.strong,{children:"Interacci\xf3n con el Frontend"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Desde el Modal de Pago (",(0,i.jsx)(n.code,{children:"pay-modal"}),"):"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Los datos de la tarjeta se env\xedan al API de OpenPay desde el frontend para generar un token seguro (",(0,i.jsx)(n.code,{children:"source_id"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Este token y los datos del cliente se env\xedan al backend a trav\xe9s del m\xe9todo ",(0,i.jsx)(n.code,{children:"pay_openpay"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"La respuesta del m\xe9todo se utiliza para mostrar mensajes de \xe9xito o error en el frontend."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"m\xe9todo-post_ad",children:(0,i.jsxs)(n.strong,{children:["M\xe9todo: ",(0,i.jsx)(n.code,{children:"post_ad"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ruta:"})," ",(0,i.jsx)(n.code,{children:"/contratar_plan"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Este m\xe9todo gestiona la asociaci\xf3n de un aviso a un plan contratado por el usuario. Valida la disponibilidad del plan, publica el aviso y actualiza el historial de avisos."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"detalles-t\xe9cnicos-1",children:(0,i.jsx)(n.strong,{children:"Detalles T\xe9cnicos"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Entradas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Par\xe1metros enviados desde el frontend:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"plan_id"}),": Identificador del plan."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"aviso_id"}),": Identificador del aviso."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tipo_aviso"}),": Tipo de aviso (t\xedpico, top, premium)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"plan_user_id"}),": (Opcional) Identificador de un plan ya existente asociado al usuario."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo de Trabajo:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validaci\xf3n de Datos:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Se asegura que los par\xe1metros requeridos sean v\xe1lidos."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verificaci\xf3n del Usuario:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Comprueba si el usuario est\xe1 autenticado."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Gesti\xf3n del Plan:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si el plan no existe (",(0,i.jsx)(n.code,{children:"plan_user_id"})," no enviado):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Recupera los detalles del plan (",(0,i.jsx)(n.code,{children:"typical_ads"}),", ",(0,i.jsx)(n.code,{children:"top_ads"}),", ",(0,i.jsx)(n.code,{children:"premium_ads"}),") y los inicializa."]}),"\n",(0,i.jsxs)(n.li,{children:["Calcula la duraci\xf3n del plan (",(0,i.jsx)(n.code,{children:"start_date"}),", ",(0,i.jsx)(n.code,{children:"end_date"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Crea un nuevo registro en la tabla ",(0,i.jsx)(n.code,{children:"plan_users"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Si el plan ya existe:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Recupera la informaci\xf3n del plan asociado al usuario."}),"\n",(0,i.jsx)(n.li,{children:"Verifica su estado (activo/inactivo) y su fecha de expiraci\xf3n."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Publicaci\xf3n del Aviso:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Actualiza el tipo de aviso y la cantidad de avisos restantes en el plan."}),"\n",(0,i.jsxs)(n.li,{children:["Registra el cambio en la tabla ",(0,i.jsx)(n.code,{children:"historial_avisos"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Env\xedo de Notificaci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Env\xeda un correo al usuario con los detalles del aviso publicado."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Salidas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Respuesta JSON que incluye:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Estado de la operaci\xf3n (",(0,i.jsx)(n.code,{children:"status"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Mensaje de \xe9xito o error."}),"\n",(0,i.jsxs)(n.li,{children:["Identificador del ",(0,i.jsx)(n.code,{children:"plan_user"})," actualizado."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"interacci\xf3n-con-el-frontend-1",children:(0,i.jsx)(n.strong,{children:"Interacci\xf3n con el Frontend"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Desde el Modal de Pago (",(0,i.jsx)(n.code,{children:"pay-modal"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Una vez que el pago es exitoso, el frontend realiza una llamada al m\xe9todo ",(0,i.jsx)(n.code,{children:"post_ad"})," para asociar el aviso al plan adquirido."]}),"\n",(0,i.jsx)(n.li,{children:"La respuesta de este m\xe9todo informa si la asociaci\xf3n fue exitosa y redirige al usuario a la p\xe1gina de gesti\xf3n de avisos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"m\xe9todo-get_data_openpay",children:(0,i.jsxs)(n.strong,{children:["M\xe9todo: ",(0,i.jsx)(n.code,{children:"get_data_openpay"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ruta:"})," ",(0,i.jsx)(n.code,{children:"/get-data-openpay"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Proporciona las credenciales necesarias para inicializar OpenPay en el frontend."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"detalles-t\xe9cnicos-2",children:(0,i.jsx)(n.strong,{children:"Detalles T\xe9cnicos"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Entradas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Este m\xe9todo no recibe par\xe1metros del cliente."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo de Trabajo:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Obtenci\xf3n de Credenciales:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Recupera las credenciales de OpenPay desde el archivo ",(0,i.jsx)(n.code,{children:".env"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_ID"}),": Identificador \xfanico de la cuenta."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_PK"}),": Clave p\xfablica utilizada para el frontend."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENPAY_SANDBOX_MODE"}),": Modo de prueba o producci\xf3n."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validaci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verifica que las credenciales sean v\xe1lidas y no est\xe9n vac\xedas."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Respuesta:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Devuelve las credenciales en formato JSON."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Salidas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Objeto JSON con:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"openpay_id"}),": Identificador \xfanico."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"openpay_pk"}),": Clave p\xfablica."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"openpay_sb_mode"}),": Indicador del modo sandbox."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"interacci\xf3n-con-el-frontend-2",children:(0,i.jsx)(n.strong,{children:"Interacci\xf3n con el Frontend"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Desde el Modal de Pago (",(0,i.jsx)(n.code,{children:"pay-modal"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El frontend llama a este m\xe9todo para obtener las credenciales de OpenPay y configurar la integraci\xf3n de pagos en el cliente."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"resumen-de-interacciones-con-el-frontend",children:(0,i.jsx)(n.strong,{children:"Resumen de Interacciones con el Frontend"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo de Pago:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El cliente selecciona un plan y proporciona los datos de su tarjeta en el modal."}),"\n",(0,i.jsxs)(n.li,{children:["El frontend utiliza ",(0,i.jsx)(n.code,{children:"get_data_openpay"})," para configurar OpenPay."]}),"\n",(0,i.jsxs)(n.li,{children:["Una vez configurado, genera un token seguro (",(0,i.jsx)(n.code,{children:"source_id"}),") y lo env\xeda a trav\xe9s de ",(0,i.jsx)(n.code,{children:"pay_openpay"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el pago es exitoso, llama a ",(0,i.jsx)(n.code,{children:"post_ad"})," para asociar el aviso al plan."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Errores y Notificaciones:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Los errores de OpenPay (como tarjeta rechazada) se manejan y se muestran en el frontend mediante ",(0,i.jsx)(n.code,{children:"Toast"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"En caso de \xe9xito, el usuario es redirigido a la p\xe1gina de gesti\xf3n de avisos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-apis-y-detalles-t\xe9cnicos",children:"7. APIs y Detalles T\xe9cnicos"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"openpay",children:(0,i.jsx)(n.strong,{children:"OpenPay"})}),"\n",(0,i.jsx)(n.p,{children:"La integraci\xf3n con OpenPay se utiliza para procesar los pagos con tarjeta de cr\xe9dito y d\xe9bito en la plataforma."}),"\n",(0,i.jsx)(n.h4,{id:"detalles-t\xe9cnicos-3",children:(0,i.jsx)(n.strong,{children:"Detalles T\xe9cnicos"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Base URL:"})," Recuperada desde la variable de entorno ",(0,i.jsx)(n.code,{children:"OPENPAY_URL"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Autenticaci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Clave p\xfablica y privada configuradas en las variables ",(0,i.jsx)(n.code,{children:"OPENPAY_ID"})," y ",(0,i.jsx)(n.code,{children:"OPENPAY_SK"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Token de autorizaci\xf3n codificado en formato Base64."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Operaciones Implementadas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Crear un token de pago:"})," Se genera un token seguro que identifica la tarjeta sin exponer informaci\xf3n sensible."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Registrar la transacci\xf3n:"})," Realiza el cargo al cliente con el token generado."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"estructura-de-la-solicitud",children:(0,i.jsx)(n.strong,{children:"Estructura de la Solicitud"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Endpoint:"})," ",(0,i.jsx)(n.code,{children:"/charges"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"M\xe9todo:"})," ",(0,i.jsx)(n.code,{children:"POST"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Cuerpo de la solicitud:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "source_id": "tok_test_123456789",\r\n  "method": "card",\r\n  "amount": 129.00,\r\n  "currency": "PEN",\r\n  "description": "Plan adquirido: Top - Vigencia: 30 d\xedas - Avisos: 1",\r\n  "device_session_id": "ds_test_123456789",\r\n  "customer": {\r\n    "name": "John",\r\n    "last_name": "Doe",\r\n    "phone_number": "987654321",\r\n    "email": "johndoe@example.com"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"estructura-de-la-respuesta",children:(0,i.jsx)(n.strong,{children:"Estructura de la Respuesta"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\xc9xito:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "completed",\r\n  "authorization": "123456",\r\n  "operation_type": "in",\r\n  "transaction_type": "charge",\r\n  "card": {\r\n    "type": "debit",\r\n    "brand": "visa",\r\n    "holder_name": "John Doe",\r\n    "bank_name": "Banco Test",\r\n    "bank_code": "12345"\r\n  }\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Error:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "failed",\r\n  "error_code": "1004",\r\n  "description": "La tarjeta fue rechazada.",\r\n  "request_id": "req_test_123456789"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"fetch-requests",children:(0,i.jsx)(n.strong,{children:"Fetch Requests"})}),"\n",(0,i.jsx)(n.p,{children:"Se utilizan en el frontend para interactuar con los endpoints del backend. Estas solicitudes est\xe1n dise\xf1adas para manejar las operaciones de pago y publicaci\xf3n."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"endpoint-post-pagar-openpay",children:[(0,i.jsx)(n.strong,{children:"Endpoint:"})," ",(0,i.jsx)(n.code,{children:"POST /pagar-openpay"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Procesa el pago del usuario utilizando OpenPay."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Entradas (Request Body):"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "source_id": "tok_test_123456789",\r\n  "method": "card",\r\n  "amount": 129.00,\r\n  "currency": "PEN",\r\n  "description": "Plan adquirido: Top - Vigencia: 30 d\xedas - Avisos: 1",\r\n  "device_session_id": "ds_test_123456789",\r\n  "customer": {\r\n    "name": "John",\r\n    "last_name": "Doe",\r\n    "phone_number": "987654321",\r\n    "email": "johndoe@example.com"\r\n  }\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\xc9xito:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "completed",\r\n  "authorization": "123456",\r\n  "transaction_id": "txn_123456789",\r\n  "message": "Pago procesado exitosamente."\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Error:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "failed",\r\n  "error_code": "1004",\r\n  "message": "La tarjeta fue rechazada."\r\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"endpoint-post-contratar_plan",children:[(0,i.jsx)(n.strong,{children:"Endpoint:"})," ",(0,i.jsx)(n.code,{children:"POST /contratar_plan"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Registra el plan adquirido por el usuario y publica el aviso."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Entradas (Request Body):"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "plan_id": 1,\r\n  "tipo_aviso": 3,\r\n  "aviso_id": 5,\r\n  "plan_user_id": null\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\xc9xito:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Plan contratado exitosamente.",\r\n  "plan_user_id": 10,\r\n  "aviso": {\r\n    "id": 5,\r\n    "status": "publicado"\r\n  }\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Error:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "error",\r\n  "message": "El plan que deseas usar est\xe1 caducado."\r\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"endpoint-post-get-data-openpay",children:[(0,i.jsx)(n.strong,{children:"Endpoint:"})," ",(0,i.jsx)(n.code,{children:"POST /get-data-openpay"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"})," Recupera las credenciales necesarias para inicializar OpenPay en el frontend."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Entradas:"})," No requiere cuerpo de la solicitud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Respuestas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\xc9xito:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "openpay_id": "openpay_test_12345",\r\n  "openpay_pk": "pk_test_67890",\r\n  "openpay_sb_mode": true\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Error:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "error",\r\n  "message": "Error al consultar la data de OpenPay."\r\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"interacci\xf3n-completa",children:(0,i.jsx)(n.strong,{children:"Interacci\xf3n Completa"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Obtener Credenciales (",(0,i.jsx)(n.code,{children:"/get-data-openpay"}),"):"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El frontend llama a este endpoint para configurar OpenPay."}),"\n",(0,i.jsx)(n.li,{children:"Las credenciales se utilizan para inicializar el SDK de OpenPay en el cliente."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Procesar Pago (",(0,i.jsx)(n.code,{children:"/pagar-openpay"}),"):"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los datos de la tarjeta se env\xedan a OpenPay a trav\xe9s del backend."}),"\n",(0,i.jsx)(n.li,{children:"Se devuelve la respuesta del pago al frontend."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Registrar Plan y Aviso (",(0,i.jsx)(n.code,{children:"/contratar_plan"}),"):"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Una vez procesado el pago, el frontend registra el plan y publica el aviso."}),"\n",(0,i.jsx)(n.li,{children:"Si el aviso es publicado correctamente, el frontend redirige al usuario a la p\xe1gina de gesti\xf3n de avisos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-vistas-relacionadas-con-el-pago",children:"8. Vistas Relacionadas con el Pago"}),"\n",(0,i.jsx)(n.p,{children:"Este numeral describe las vistas y componentes Blade implicados en el flujo de pago para propietarios, acreedores y corredores."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"81-vistas-de-selecci\xf3n-de-planes",children:(0,i.jsx)(n.strong,{children:"8.1. Vistas de Selecci\xf3n de Planes"})}),"\n",(0,i.jsx)(n.h4,{id:"planesbladephp",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"planes.blade.php"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ubicaci\xf3n:"})," ",(0,i.jsx)(n.code,{children:"resources/views/planes.blade.php"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Esta vista est\xe1 orientada a los corredores y muestra los planes disponibles espec\xedficamente dise\xf1ados para ellos. Desde esta vista, los usuarios pueden seleccionar un plan que deseen contratar."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Estructura Principal:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Listado de planes para corredores con sus caracter\xedsticas (precio, duraci\xf3n, cantidad de avisos permitidos)."}),"\n",(0,i.jsxs)(n.li,{children:["Bot\xf3n de acci\xf3n para contratar el plan seleccionado, que abre el modal de pago (",(0,i.jsx)(n.code,{children:"pay-modal"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Interacci\xf3n con el Backend:"}),(0,i.jsx)(n.br,{}),"\n","Cuando se selecciona un plan, el frontend interact\xfaa con los endpoints ",(0,i.jsx)(n.code,{children:"/pagar-openpay"})," para procesar el pago y ",(0,i.jsx)(n.code,{children:"/contratar_plan"})," para asociar el aviso al plan adquirido."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"planes-acreedorbladephp",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"planes-acreedor.blade.php"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ubicaci\xf3n:"})," ",(0,i.jsx)(n.code,{children:"resources/views/planes-acreedor.blade.php"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Similar a ",(0,i.jsx)(n.code,{children:"planes.blade.php"}),", pero adaptada para los acreedores. Presenta planes espec\xedficos para este tipo de usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Diferencias Principales:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Personalizaci\xf3n de la lista de planes seg\xfan las necesidades de los acreedores."}),"\n",(0,i.jsx)(n.li,{children:"Elementos adicionales para filtrar o clasificar los planes."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"planes-propietariobladephp",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"planes-propietario.blade.php"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ubicaci\xf3n:"})," ",(0,i.jsx)(n.code,{children:"resources/views/planes-propietario.blade.php"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Muestra los planes orientados exclusivamente a los propietarios que desean publicar inmuebles."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Diferencias Principales:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los planes mostrados est\xe1n enfocados en la publicaci\xf3n de inmuebles y maximizar su visibilidad en la plataforma."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"82-componente-centralizado-de-pago",children:(0,i.jsx)(n.strong,{children:"8.2. Componente Centralizado de Pago"})}),"\n",(0,i.jsx)(n.h4,{id:"pay-modalbladephp",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"pay-modal.blade.php"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ubicaci\xf3n:"})," ",(0,i.jsx)(n.code,{children:"resources/views/components/pay-modal.blade.php"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Este componente es el n\xfacleo del sistema de pagos en el frontend. Se utiliza como modal emergente para que los usuarios ingresen los datos de su tarjeta y completen el proceso de pago."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Caracter\xedsticas Clave:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Formulario para ingresar datos de la tarjeta:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"N\xfamero de tarjeta."}),"\n",(0,i.jsx)(n.li,{children:"Nombre del titular."}),"\n",(0,i.jsx)(n.li,{children:"Fecha de vencimiento."}),"\n",(0,i.jsx)(n.li,{children:"CVV."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Configuraci\xf3n din\xe1mica con OpenPay:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uso de credenciales obtenidas a trav\xe9s del endpoint ",(0,i.jsx)(n.code,{children:"/get-data-openpay"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Generaci\xf3n de un token seguro (",(0,i.jsx)(n.code,{children:"source_id"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Manejo de eventos:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Env\xedo de datos de pago al endpoint ",(0,i.jsx)(n.code,{children:"/pagar-openpay"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Llamada a ",(0,i.jsx)(n.code,{children:"/contratar_plan"})," para asociar el plan una vez que el pago se realiza con \xe9xito."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Componentes de Interacci\xf3n Visual:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Toasts"})," para notificaciones de \xe9xito o error (ver secci\xf3n ",(0,i.jsx)(n.code,{children:"8.4. Notificaciones Toast"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Segundo modal para seleccionar el documento de facturaci\xf3n (DNI o RUC)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Interacci\xf3n con el Backend:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inicio del Pago:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Recupera las credenciales de OpenPay utilizando ",(0,i.jsx)(n.code,{children:"/get-data-openpay"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Configura el SDK de OpenPay en el cliente."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Procesamiento del Pago:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Env\xeda los datos al endpoint ",(0,i.jsx)(n.code,{children:"/pagar-openpay"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Maneja las respuestas del backend para notificar al usuario."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asociaci\xf3n del Aviso:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Una vez procesado el pago, se llama al endpoint ",(0,i.jsx)(n.code,{children:"/contratar_plan"})," para finalizar la publicaci\xf3n del aviso."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"83-flujo-completo-desde-el-frontend",children:(0,i.jsx)(n.strong,{children:"8.3. Flujo Completo desde el Frontend"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Selecci\xf3n del Plan:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["El usuario selecciona un plan desde una de las vistas (",(0,i.jsx)(n.code,{children:"planes.blade.php"}),", ",(0,i.jsx)(n.code,{children:"planes-acreedor.blade.php"}),", o ",(0,i.jsx)(n.code,{children:"planes-propietario.blade.php"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["El sistema abre el modal de pago (",(0,i.jsx)(n.code,{children:"pay-modal.blade.php"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ingreso de Datos de la Tarjeta:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"En el modal, el usuario ingresa los datos de su tarjeta."}),"\n",(0,i.jsxs)(n.li,{children:["OpenPay genera un token seguro (",(0,i.jsx)(n.code,{children:"source_id"}),") para evitar exponer datos sensibles."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Procesamiento del Pago:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Los datos se env\xedan al backend mediante el endpoint ",(0,i.jsx)(n.code,{children:"/pagar-openpay"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Si el pago es exitoso, el backend responde con los detalles de la transacci\xf3n."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Publicaci\xf3n del Aviso:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se realiza una solicitud al endpoint ",(0,i.jsx)(n.code,{children:"/contratar_plan"})," para asociar el aviso al plan adquirido."]}),"\n",(0,i.jsx)(n.li,{children:"Si el aviso es publicado correctamente, el usuario recibe una notificaci\xf3n y es redirigido a la p\xe1gina de gesti\xf3n de avisos."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notificaci\xf3n al Usuario:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\xc9xito:"})," El sistema muestra un mensaje de confirmaci\xf3n mediante un Toast (ver secci\xf3n ",(0,i.jsx)(n.code,{children:"8.4. Notificaciones Toast"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," Se notifica al usuario con el mensaje del error espec\xedfico."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"84-notificaciones-toast",children:(0,i.jsx)(n.strong,{children:"8.4. Notificaciones Toast"})}),"\n",(0,i.jsxs)(n.p,{children:["El sistema utiliza notificaciones visuales mediante ",(0,i.jsx)(n.strong,{children:"Toasts"})," para informar al usuario sobre el resultado del pago."]}),"\n",(0,i.jsx)(n.h4,{id:"triggertoastsuccess",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"triggerToastSuccess"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Script Relacionado:"})," ",(0,i.jsx)(n.code,{children:"resources/js/scripts/toastySuccess.js"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Muestra un Toast de \xe9xito cuando el pago se procesa correctamente."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"C\xf3digo del Script:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import * as bootstrap from 'bootstrap';\r\nconst toastSuccess = document.getElementById('toastSuccess');\r\nconst toastBootstrapSuccess = bootstrap.Toast.getOrCreateInstance(toastSuccess);\r\n\r\nfunction triggerToastSuccess() {\r\n  toastBootstrapSuccess.show();\r\n}\r\n\r\nwindow.triggerToastSuccess = triggerToastSuccess;\n"})}),"\n",(0,i.jsx)(n.h4,{id:"triggertoastpayerror",children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"triggerToastPayError"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Script Relacionado:"})," ",(0,i.jsx)(n.code,{children:"resources/js/scripts/toastyPayError.js"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Funcionalidad:"}),(0,i.jsx)(n.br,{}),"\n","Muestra un Toast de error cuando el pago falla."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"C\xf3digo del Script:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import * as bootstrap from 'bootstrap';\r\nconst toastPayError = document.getElementById('toastPayError');\r\nconst toastBootstrapPayError = bootstrap.Toast.getOrCreateInstance(toastPayError);\r\n\r\nfunction triggerToastPayError() {\r\n  toastBootstrapPayError.show();\r\n}\r\n\r\nwindow.triggerToastPayError = triggerToastPayError;\n"})}),"\n",(0,i.jsx)(n.h4,{id:"eventos-en-pay-modalbladephp",children:(0,i.jsxs)(n.strong,{children:["Eventos en ",(0,i.jsx)(n.code,{children:"pay-modal.blade.php"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Invocaci\xf3n del Toast de \xc9xito:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"triggerToastSuccess();\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Invocaci\xf3n del Toast de Error:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"triggerToastPayError();\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"85-c\xf3digo-relacionado",children:(0,i.jsx)(n.strong,{children:"8.5. C\xf3digo Relacionado"})}),"\n",(0,i.jsx)(n.h4,{id:"ejemplo-de-uso-en-planesbladephp",children:(0,i.jsxs)(n.strong,{children:["Ejemplo de Uso en ",(0,i.jsx)(n.code,{children:"planes.blade.php"}),":"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:"@component('components.pay-modal', [\r\n  'avisoId' => $aviso->id,\r\n  'userName' => Auth::user()->name,\r\n  'userSurname' => Auth::user()->surname,\r\n  'userEmail' => Auth::user()->email,\r\n  'userPhone' => Auth::user()->phone,\r\n  'userTypeId' => Auth::user()->type_id\r\n])\r\n@endcomponent\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"9-referencias-a-la-documentaci\xf3n-de-openpay",children:"9. Referencias a la Documentaci\xf3n de OpenPay"}),"\n",(0,i.jsx)(n.p,{children:"Para mayor informaci\xf3n sobre la integraci\xf3n y configuraci\xf3n de OpenPay, consulta los siguientes recursos oficiales:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Gu\xeda de Pagos con Tarjeta (M\xe9xico):"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://documents.openpay.mx/docs/card-charge.html",children:"https://documents.openpay.mx/docs/card-charge.html"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Documentaci\xf3n General de Pagos con Tarjeta (Per\xfa):"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://documents.openpay.pe/documentacion/pagos-con-tarjeta/",children:"https://documents.openpay.pe/documentacion/pagos-con-tarjeta/"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"10-historial-de-cambios",children:"10. Historial de Cambios"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Versi\xf3n"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Fecha"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Cambios Realizados"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Autor"})})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"v1.0"}),(0,i.jsx)(n.td,{children:"06/12/2024"}),(0,i.jsx)(n.td,{children:"Documento t\xe9cnico inicial creado"}),(0,i.jsx)(n.td,{children:"Walker Alfaro"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>a});var r=s(6540);const i={},l=r.createContext(i);function d(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);