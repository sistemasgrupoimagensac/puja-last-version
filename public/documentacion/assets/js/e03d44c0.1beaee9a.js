"use strict";(self.webpackChunkdocumentacion=self.webpackChunkdocumentacion||[]).push([[2860],{7382:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"tecnica/DT_Registro_Usuario_Google","title":"Registro con Google","description":"1. Resumen","source":"@site/docs/tecnica/DT_Registro_Usuario_Google.md","sourceDirName":"tecnica","slug":"/tecnica/DT_Registro_Usuario_Google","permalink":"/documentacion/docs/tecnica/DT_Registro_Usuario_Google","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Registro con Google","sidebar_position":2,"title":"Registro con Google"},"sidebar":"documentationSidebar","previous":{"title":"Registro de Usuario","permalink":"/documentacion/docs/tecnica/DT_Registro_Usuario"},"next":{"title":"Inicio de Sesi\xf3n","permalink":"/documentacion/docs/tecnica/DT_Iniciar_Sesion"}}');var i=r(4848),l=r(8453);const o={sidebar_label:"Registro con Google",sidebar_position:2,title:"Registro con Google"},d="Documento T\xe9cnico: Registro de Usuario con Google",c={},a=[{value:"1. Resumen",id:"1-resumen",level:2},{value:"2. Requisitos Funcionales Relacionados",id:"2-requisitos-funcionales-relacionados",level:2},{value:"3. Rutas",id:"3-rutas",level:2},{value:"4. Modelo Relacionado: <code>User</code>",id:"4-modelo-relacionado-user",level:2},{value:"Campos de la Tabla <code>users</code>",id:"campos-de-la-tabla-users",level:4},{value:"<strong>C\xf3mo se Guardan los Datos en la Tabla</strong>",id:"c\xf3mo-se-guardan-los-datos-en-la-tabla",level:4},{value:"<strong>Relaci\xf3n con el Modelo</strong>",id:"relaci\xf3n-con-el-modelo",level:4},{value:"5. M\xe9todos del Controlador",id:"5-m\xe9todos-del-controlador",level:2},{value:"5.1. selectAccountGoogle",id:"51-selectaccountgoogle",level:3},{value:"5.2. createLoginGoogle",id:"52-createlogingoogle",level:3},{value:"6. Validaciones Implementadas",id:"6-validaciones-implementadas",level:2},{value:"7. Manejo de Errores",id:"7-manejo-de-errores",level:2},{value:"8. Flujo General de Autenticaci\xf3n",id:"8-flujo-general-de-autenticaci\xf3n",level:2},{value:"9. Historial de Cambios",id:"9-historial-de-cambios",level:2}];function t(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"documento-t\xe9cnico-registro-de-usuario-con-google",children:"Documento T\xe9cnico: Registro de Usuario con Google"})}),"\n",(0,i.jsx)(n.h2,{id:"1-resumen",children:"1. Resumen"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"}),(0,i.jsx)(n.br,{}),"\n","El flujo de registro e inicio de sesi\xf3n mediante Google est\xe1 implementado en el controlador ",(0,i.jsx)(n.code,{children:"SuppliersController"}),". Este flujo permite a los usuarios autenticarse con Google OAuth 2.0, recuperar sus datos b\xe1sicos (nombre, correo electr\xf3nico, y avatar) y registrar o iniciar sesi\xf3n autom\xe1ticamente en la plataforma. Este documento explica en detalle el backend y c\xf3mo gestiona el registro e inicio de sesi\xf3n."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-requisitos-funcionales-relacionados",children:"2. Requisitos Funcionales Relacionados"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"ID"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Nombre del Requisito"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RF002"})}),(0,i.jsx)(n.td,{children:"Registro de Usuario con Google"}),(0,i.jsx)(n.td,{children:"Permite a los usuarios registrarse con una cuenta de Google."})]})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-rutas",children:"3. Rutas"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Ruta"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"M\xe9todo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Controlador"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/google-auth/redirect"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SuppliersController@selectAccountGoogle"})}),(0,i.jsx)(n.td,{children:"Redirige al usuario para seleccionar su cuenta de Google."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/google-auth/callback"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SuppliersController@createLoginGoogle"})}),(0,i.jsx)(n.td,{children:"Procesa el callback tras la autenticaci\xf3n con Google."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"4-modelo-relacionado-user",children:["4. Modelo Relacionado: ",(0,i.jsx)(n.code,{children:"User"})]}),"\n",(0,i.jsxs)(n.p,{children:["En este flujo, los datos del usuario autenticado o registrado mediante Google se almacenan en la tabla ",(0,i.jsx)(n.code,{children:"users"}),". A continuaci\xf3n, se detalla c\xf3mo se gestionan y qu\xe9 representan los campos en la tabla:"]}),"\n",(0,i.jsxs)(n.h4,{id:"campos-de-la-tabla-users",children:["Campos de la Tabla ",(0,i.jsx)(n.code,{children:"users"})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Campo"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Descripci\xf3n"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Origen de los Datos"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"id"})}),(0,i.jsx)(n.td,{children:"Identificador \xfanico del usuario. Se genera autom\xe1ticamente al crear un nuevo registro."}),(0,i.jsx)(n.td,{children:"Generado por la base de datos."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"nombres"})}),(0,i.jsx)(n.td,{children:"Nombre completo del usuario autenticado mediante Google."}),(0,i.jsxs)(n.td,{children:["Recuperado desde Google (",(0,i.jsx)(n.code,{children:"$user_google->name"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"email"})}),(0,i.jsx)(n.td,{children:"Correo electr\xf3nico del usuario. Este es \xfanico en la tabla."}),(0,i.jsxs)(n.td,{children:["Recuperado desde Google (",(0,i.jsx)(n.code,{children:"$user_google->email"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"password"})}),(0,i.jsxs)(n.td,{children:["Contrase\xf1a del usuario. Para usuarios de Google, este campo permanece vac\xedo (",(0,i.jsx)(n.code,{children:"null"}),")."]}),(0,i.jsx)(n.td,{children:"No aplica para este flujo."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"google_id"})}),(0,i.jsx)(n.td,{children:"Identificador \xfanico proporcionado por Google para el usuario."}),(0,i.jsxs)(n.td,{children:["Recuperado desde Google (",(0,i.jsx)(n.code,{children:"$user_google->id"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"imagen"})}),(0,i.jsx)(n.td,{children:"URL de la imagen de perfil del usuario."}),(0,i.jsxs)(n.td,{children:["Recuperado desde Google (",(0,i.jsx)(n.code,{children:"$user_google->avatar"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"tipo_usuario_id"})}),(0,i.jsx)(n.td,{children:"Identificador del tipo de usuario (rol) en la plataforma."}),(0,i.jsxs)(n.td,{children:["Definido en la sesi\xf3n (",(0,i.jsx)(n.code,{children:"session('profile_type')"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"email_verified_at"})}),(0,i.jsx)(n.td,{children:"Marca la fecha y hora en la que se verific\xf3 el correo electr\xf3nico. Para Google, se marca al registro."}),(0,i.jsxs)(n.td,{children:["Se asigna con ",(0,i.jsx)(n.code,{children:"now()"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"created_at"})}),(0,i.jsx)(n.td,{children:"Fecha y hora de creaci\xf3n del registro."}),(0,i.jsx)(n.td,{children:"Generado autom\xe1ticamente."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"updated_at"})}),(0,i.jsx)(n.td,{children:"Fecha y hora de la \xfaltima actualizaci\xf3n del registro."}),(0,i.jsx)(n.td,{children:"Generado autom\xe1ticamente."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"c\xf3mo-se-guardan-los-datos-en-la-tabla",children:(0,i.jsx)(n.strong,{children:"C\xf3mo se Guardan los Datos en la Tabla"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo para Usuarios Nuevos:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cuando el usuario no existe en la base de datos, se crea un nuevo registro utilizando el modelo ",(0,i.jsx)(n.code,{children:"User"}),":","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$user = User::create([\r\n    'google_id' => $user_google->id,\r\n    'nombres' => $user_google->name,\r\n    'email' => $user_google->email,\r\n    'imagen' => $user_google->avatar,\r\n    'tipo_usuario_id' => $profile_type,\r\n    'email_verified_at' => now(),\r\n]);\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Explicaci\xf3n del Registro:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"google_id"}),":"]})," Se guarda el identificador \xfanico proporcionado por Google."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"nombres"}),":"]})," Se almacena el nombre completo del usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"email"}),":"]})," Se guarda el correo electr\xf3nico recuperado de Google, garantizando que sea \xfanico."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"imagen"}),":"]})," Se almacena la URL del avatar del usuario proporcionado por Google."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"tipo_usuario_id"}),":"]})," Define el rol del usuario (e.g., propietario, corredor), y se obtiene de la sesi\xf3n (",(0,i.jsx)(n.code,{children:"profile_type"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"email_verified_at"}),":"]})," Se marca autom\xe1ticamente como verificado en la fecha y hora actual (",(0,i.jsx)(n.code,{children:"now()"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flujo para Usuarios Existentes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si el usuario ya existe en la base de datos (verificado por ",(0,i.jsx)(n.code,{children:"google_id"}),"):","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$existingUser = User::where('google_id', $user_google->id)->first();\r\nAuth::login($existingUser);\n"})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"No se crea un nuevo registro. En su lugar, el usuario existente se autentica y accede a la plataforma."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Valores por Defecto:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"password"}),":"]})," Permanece ",(0,i.jsx)(n.code,{children:"null"})," ya que el usuario utiliza Google para autenticarse."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"created_at"})," y ",(0,i.jsx)(n.code,{children:"updated_at"}),":"]})," Se generan autom\xe1ticamente por el framework."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"relaci\xf3n-con-el-modelo",children:(0,i.jsx)(n.strong,{children:"Relaci\xf3n con el Modelo"})}),"\n",(0,i.jsxs)(n.p,{children:["El modelo ",(0,i.jsx)(n.code,{children:"User"})," en Laravel permite manipular la tabla ",(0,i.jsx)(n.code,{children:"users"})," y definir las relaciones, validaciones y comportamientos asociados a este flujo de registro."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected $fillable = [\r\n    'google_id',\r\n    'nombres',\r\n    'email',\r\n    'imagen',\r\n    'tipo_usuario_id',\r\n    'email_verified_at',\r\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Este array define los campos que pueden ser asignados masivamente al crear o actualizar registros, como en el caso de:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"User::create([...]);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-m\xe9todos-del-controlador",children:"5. M\xe9todos del Controlador"}),"\n",(0,i.jsx)(n.h3,{id:"51-selectaccountgoogle",children:"5.1. selectAccountGoogle"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"}),(0,i.jsx)(n.br,{}),"\n","Este m\xe9todo redirige al usuario a la p\xe1gina de autenticaci\xf3n de Google con la opci\xf3n de seleccionar una cuenta espec\xedfica, utilizando el par\xe1metro ",(0,i.jsx)(n.code,{children:"prompt=select_account"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"C\xf3digo del M\xe9todo:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function selectAccountGoogle() {\r\n    return Socialite::driver('google')\r\n        ->with(['prompt' => 'select_account'])\r\n        ->redirect();   \r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explicaci\xf3n:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"Socialite::driver('google')"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Configura el driver de Google para gestionar la autenticaci\xf3n."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"with(['prompt' => 'select_account'])"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Agrega un par\xe1metro adicional para forzar al usuario a seleccionar una cuenta espec\xedfica, incluso si ya est\xe1 autenticado con una cuenta en Google."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"->redirect()"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Redirige al usuario a la p\xe1gina de autenticaci\xf3n de Google."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"52-createlogingoogle",children:"5.2. createLoginGoogle"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Descripci\xf3n:"}),(0,i.jsx)(n.br,{}),"\n","Este m\xe9todo maneja el callback tras la autenticaci\xf3n con Google. Verifica si el usuario ya existe en la base de datos y, dependiendo del caso, lo autentica o lo registra como un nuevo usuario."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"C\xf3digo del M\xe9todo:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function createLoginGoogle() {\r\n    $user_google = Socialite::driver('google')->user();\r\n    $profile_type = session('profile_type', 2); \r\n    $existingUser = User::where('google_id', $user_google->id)->first();\r\n\r\n    if ($existingUser) {\r\n        // Loguear al usuario existente\r\n        Auth::login($existingUser);\r\n        return redirect('/')->with('user', $existingUser->toJson());\r\n    } else {\r\n        // Crear un nuevo usuario\r\n        $user = User::create([\r\n            'google_id' => $user_google->id,\r\n            'nombres' => $user_google->name,\r\n            'email' => $user_google->email,\r\n            'imagen' => $user_google->avatar,\r\n            'tipo_usuario_id' => $profile_type,\r\n            'email_verified_at' => now(),\r\n        ]);\r\n\r\n        // Loguear al nuevo usuario\r\n        Auth::login($user);\r\n        return redirect('/')->with('user', $user->toJson());\r\n    } \r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explicaci\xf3n Paso a Paso:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"$user_google = Socialite::driver('google')->user()"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Recupera la informaci\xf3n del usuario autenticado desde Google."}),"\n",(0,i.jsxs)(n.li,{children:["Devuelve un objeto que contiene:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": Identificador \xfanico de Google."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"}),": Nombre del usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"email"}),": Correo electr\xf3nico del usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"avatar"}),": URL de la imagen de perfil."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"$profile_type = session('profile_type', 2)"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Recupera el tipo de perfil seleccionado por el usuario desde la sesi\xf3n."}),"\n",(0,i.jsxs)(n.li,{children:["El valor por defecto es ",(0,i.jsx)(n.code,{children:"2"}),", que representa un perfil est\xe1ndar."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"$existingUser = User::where('google_id', $user_google->id)->first()"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Busca en la base de datos si existe un usuario registrado con el identificador de Google (",(0,i.jsx)(n.code,{children:"google_id"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Si el Usuario Existe:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"Auth::login($existingUser)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Inicia sesi\xf3n autom\xe1ticamente al usuario existente."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"redirect('/')->with('user', $existingUser->toJson())"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Redirige al usuario a la p\xe1gina principal, pasando su informaci\xf3n como JSON."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Si el Usuario No Existe:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Registro del Usuario:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$user = User::create([\r\n    'google_id' => $user_google->id,\r\n    'nombres' => $user_google->name,\r\n    'email' => $user_google->email,\r\n    'imagen' => $user_google->avatar,\r\n    'tipo_usuario_id' => $profile_type,\r\n    'email_verified_at' => now(),\r\n]);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Crea un nuevo usuario con los datos recuperados de Google."}),"\n",(0,i.jsxs)(n.li,{children:["Asigna el tipo de perfil desde la sesi\xf3n (",(0,i.jsx)(n.code,{children:"tipo_usuario_id"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Marca el correo como verificado (",(0,i.jsx)(n.code,{children:"email_verified_at"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"Auth::login($user)"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Inicia sesi\xf3n autom\xe1ticamente con el nuevo usuario registrado."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"redirect('/')->with('user', $user->toJson())"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Redirige al usuario a la p\xe1gina principal."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Manejo de Errores:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"En caso de problemas con el callback, el flujo puede personalizarse para redirigir al login con mensajes espec\xedficos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-validaciones-implementadas",children:"6. Validaciones Implementadas"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Verificar Google ID:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se asegura que no existan usuarios duplicados con el mismo ",(0,i.jsx)(n.code,{children:"google_id"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Correo Electr\xf3nico \xdanico:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Garantiza que el correo recuperado de Google no est\xe9 duplicado en la base de datos."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Tipo de Perfil:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se utiliza un valor por defecto (",(0,i.jsx)(n.code,{children:"2"}),") si no se especifica un tipo de perfil en la sesi\xf3n."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Email Verificado:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los usuarios registrados a trav\xe9s de Google tienen autom\xe1ticamente el estado de correo verificado."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-manejo-de-errores",children:"7. Manejo de Errores"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Problemas con Google OAuth:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si Google no responde correctamente, se redirige al login con un mensaje de error."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Errores al Guardar el Usuario:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"En caso de problemas con la base de datos, se puede personalizar la respuesta para mostrar un mensaje al usuario."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-flujo-general-de-autenticaci\xf3n",children:"8. Flujo General de Autenticaci\xf3n"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Redirecci\xf3n Inicial:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El usuario es enviado a Google para autenticarse y seleccionar una cuenta."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Callback:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Google redirige al sistema con un c\xf3digo de autorizaci\xf3n."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Registro/Inicio de Sesi\xf3n:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si el usuario ya existe, se autentica."}),"\n",(0,i.jsx)(n.li,{children:"Si el usuario no existe, se registra y se autentica."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Redirecci\xf3n Final:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El usuario es redirigido a la p\xe1gina principal con su sesi\xf3n iniciada."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"9-historial-de-cambios",children:"9. Historial de Cambios"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Versi\xf3n"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Fecha"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Cambios Realizados"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Autor"})})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"v1.0"}),(0,i.jsx)(n.td,{children:"11/12/2024"}),(0,i.jsx)(n.td,{children:"Documento t\xe9cnico inicial creado."}),(0,i.jsx)(n.td,{children:"Walker Alfaro"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var s=r(6540);const i={},l=s.createContext(i);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);